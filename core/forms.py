# file: core/forms.py

from django import forms
from django.contrib.auth.models import User

from core.models import ClassName, Subject, Chapter

# থানা সহ সম্পূর্ণ ডেটা স্ট্রাকচার
BANGLADESH_DIVISIONS_DISTRICTS_THANAS = {
    "ঢাকা": {
        "ঢাকা": ["ধামরাই", "দোহার", "কেরাণীগঞ্জ", "নবাবগঞ্জ", "সাভার"],
        "ঢাকা উত্তর সিটি করপোরেশন (DNCC)": ["গুলশান", "বনানী", "বাড্ডা", "কাফরুল", "মিরপুর", "পল্লবী",
                                            "উত্তরা পূর্ব", "উত্তরা পশ্চিম", "তেজগাঁও", "তেজগাঁও শিল্পাঞ্চল",
                                            "শাহআলী", "ভাষানটেক", "রূপনগর", "ধানমন্ডি (আংশিক)"],
        "ঢাকা দক্ষিণ সিটি করপোরেশন (DSCC)": ["সূত্রাপুর", "কোতোয়ালি", "চকবাজার", "লালবাগ", "হাজারীবাগ",
                                             "কালীবাগান", "নিউমার্কেট", "শাহবাগ", "রমনা", "সবুজবাগ",
                                             "খিলগাঁও", "মতিঝিল", "পল্টন", "গেন্ডারিয়া", "ওয়ারী", "ডেমরা",
                                             "যাত্রাবাড়ী"],
        "গাজীপুর": ["কালিয়াকৈর", "কালীগঞ্জ", "কাপাসিয়া", "শ্রীপুর", "গাজীপুর সদর (জয়দেবপুর)"],
        "গাজীপুর সিটি করপোরেশন (GCC)": ["জয়দেবপুর", "টঙ্গী পশ্চিম", "টঙ্গী পূর্ব", "বাসন", "কাশিমপুর", "কাউনিয়া"],

        "নারায়ণগঞ্জ": ["আড়াইহাজার", "বন্দর", "নারায়ণগঞ্জ সদর", "রূপগঞ্জ", "সোনারগাঁও"],
        "নারায়ণগঞ্জ সিটি করপোরেশন (NCC)": ["নারায়ণগঞ্জ সদর", "বন্দর", "ফতুল্লা"],
        "নরসিংদী": ["বেলাব", "মনোহরদী", "নরসিংদী সদর", "পলাশ", "রায়পুরা", "শিবপুর"],
        "ফরিদপুর": ["আলফাডাঙ্গা", "বোয়ালমারী", "চরভদ্রাসন", "ফরিদপুর সদর", "মধুখালী", "নগরকান্দা", "সদরপুর", "সালথা"],
        "গোপালগঞ্জ": ["কাশিয়ানী", "কোটালীপাড়া", "গোপালগঞ্জ সদর", "মুকসুদপুর", "টুঙ্গিপাড়া"],
        "মাদারীপুর": ["কালকিনি", "মাদারীপুর সদর", "রাজৈর", "শিবচর"],
        "মানিকগঞ্জ": ["দৌলতপুর", "ঘিওর", "হরিরামপুর", "মানিকগঞ্জ সদর", "সাটুরিয়া", "শিবালয়", "সিঙ্গাইর"],
        "মুন্সিগঞ্জ": ["গজারিয়া", "লোহাজং", "মুন্সিগঞ্জ সদর", "শ্রীনগর", "সিরাজদিখান", "টংগীবাড়ি"],
        "রাজবাড়ী": ["বালিয়াকান্দি", "গোয়ালন্দ", "কালুখালী", "পাংশা", "রাজবাড়ী সদর"],
        "শরীয়তপুর": ["ভেদরগঞ্জ", "ডামুড্যা", "গোসাইরহাট", "নড়িয়া", "শরীয়তপুর সদর", "জাজিরা"],
        "টাঙ্গাইল": ["বাসাইল", "ভুয়াপুর", "দেলদুয়ার", "ঘাটাইল", "গোপালপুর", "কালিহাতী", "মধুপুর", "মির্জাপুর",
                     "নাগরপুর", "সখিপুর", "টাঙ্গাইল সদর"],
        "কিশোরগঞ্জ": ["অষ্টগ্রাম", "বাজিতপুর", "ভৈরব", "হোসেনপুর", "ইটনা", "করিমগঞ্জ", "কটিয়াদী", "কুলিয়ারচর",
                      "কিশোরগঞ্জ সদর", "মিঠামইন", "নিকলী", "পাকুন্দিয়া", "তাড়াইল"]
        # ... ঢাকার অন্যান্য জেলা এবং তাদের থানা ...
    },
    "চট্টগ্রাম": {
        "চট্টগ্রাম": [
            "আনোয়ারা", "বাঁশখালী", "বোয়ালখালী", "চান্দগাঁও", "চন্দনাইশ", "ফটিকছড়ি", "হাটহাজারী",
            "লোহাগাড়া", "মীরসরাই", "পটিয়া", "রাউজান", "সন্দ্বীপ", "সাতকানিয়া", "সীতাকুণ্ড"
        ],
        "চট্টগ্রাম সিটি করপোরেশন (CCC)": ["পাহাড়তলী", "বন্দর", "কোতোয়ালি", "চকবাজার", "খুলশী", "হালিশহর",
                                          "বাকলিয়া", "ডবলমুরিং", "বায়েজিদ বোস্তামী", "ইপিজেড", "পতেঙ্গা", "আগ্রাবাদ"],
        "কক্সবাজার": ["কক্সবাজার সদর", "টেকনাফ", "উখিয়া", "রামু", "মহেশখালী", "চকরিয়া", "পেকুয়া", "কুতুবদিয়া"],
        "বান্দরবান": ["বান্দরবান সদর", "আলীকদম", "লামা", "নাইক্ষ্যংছড়ি", "রুমা", "রোয়াংছড়ি", "থানচি"],
        "রাঙ্গামাটি": ["রাঙ্গামাটি সদর", "কাপ্তাই", "লংগদু", "রাজস্থলী", "বাঘাইছড়ি", "বিলাইছড়ি", "জুরাছড়ি", "বরকল",
                       "নানিয়ারচর"],
        "খাগড়াছড়ি": ["খাগড়াছড়ি সদর", "দিঘীনালা", "মহালছড়ি", "মানিকছড়ি", "মাটিরাঙ্গা", "পানছড়ি", "লক্ষীছড়ি",
                       "গুইমারা", "রামগড়"],
        "ফেনী": ["ফেনী সদর", "সোনাগাজী", "দাগনভূঞা", "ছাগলনাইয়া", "পরশুরাম", "ফুলগাজী"],
        "নোয়াখালী": ["নোয়াখালী সদর", "সোনাইমুড়ি", "চাটখিল", "বেগমগঞ্জ", "কোম্পানীগঞ্জ", "সুবর্ণচর", "কবিরহাট",
                      "হাতিয়া", "সেনবাগ"],
        "লক্ষ্মীপুর": ["লক্ষ্মীপুর সদর", "রায়পুর", "রামগঞ্জ", "রামনগর", "কমলনগর"],
        "চাঁদপুর": ["চাঁদপুর সদর", "ফরিদগঞ্জ", "হাইমচর", "হাজিগঞ্জ", "কচুয়া", "মতলব উত্তর", "মতলব দক্ষিণ",
                    "শাহরাস্তি"],
        "কুমিল্লা": ["বুড়িচং", "ব্রাহ্মণপাড়া", "চান্দিনা", "চৌদ্দগ্রাম", "দাউদকান্দি", "দেবিদ্বার", "হোমনা", "লাকসাম",
                     "লোনাগাদ", "মনোহরগঞ্জ", "মুরাদনগর", "নাঙ্গলকোট", "তিতাস", "কুমিল্লা সদর দক্ষিণ", "মেঘনা",
                     "বরুড়া"],
        "কুমিল্লা সিটি করপোরেশন (CuCC)": ["কুমিল্লা সদর", "কোতোয়ালি দক্ষিণ", "আদর্শ সদর"],
        "ব্রাহ্মণবাড়িয়া": ["ব্রাহ্মণবাড়িয়া সদর", "নবীনগর", "বাঞ্ছারামপুর", "কসবা", "সরাইল", "আশুগঞ্জ", "নাসিরনগর",
                             "আখাউড়া", "বিজয়নগর"]
        # ... চট্টগ্রামের অন্যান্য জেলা এবং তাদের থানা ...
    },
    "খুলনা": {
        "খুলনা": ["খুলনা সদর", "বটিয়াঘাটা", "ডুমুরিয়া", "দাকোপ", "তেরখাদা", "পাইকগাছা", "ফুলতলা", "রূপসা"],
        "খুলনা সিটি করপোরেশন (KCC)": ["খুলনা সদর", "সোনাডাঙ্গা", "খালিশপুর", "দৌলতপুর"],
        "বাগেরহাট": ["বাগেরহাট সদর", "মোড়েলগঞ্জ", "শরণখোলা", "চিতলমারী", "কচুয়া", "রামপাল", "মোংলা", "ফকিরহাট"],
        "যশোর": ["যশোর সদর", "চৌগাছা", "অভয়নগর", "বাঘারপাড়া", "মনিরামপুর", "ঝিকরগাছা", "শার্শা", "কেশবপুর"],
        "সাতক্ষীরা": ["সাতক্ষীরা সদর", "আশাশুনি", "কালিগঞ্জ", "দেবহাটা", "তালা", "শ্যামনগর", "কলারোয়া"],
        "নড়াইল": ["নড়াইল সদর", "লোহাগড়া", "কালিয়া"],
        "চুয়াডাঙ্গা": ["চুয়াডাঙ্গা সদর", "আলমডাঙ্গা", "দামুরহুদা", "জীবননগর"],
        "কুষ্টিয়া": ["কুষ্টিয়া সদর", "ভেড়ামারা", "খোকসা", "কুমারখালী", "দৌলতপুর", "মিরপুর"],
        "ঝিনাইদহ": ["ঝিনাইদহ সদর", "শৈলকুপা", "কালীগঞ্জ", "কোটচাঁদপুর", "মহেশপুর", "হরিণাকুন্ডু"],
        "মেহেরপুর": ["মেহেরপুর সদর", "গাংনী", "মুজিবনগর"],
        "মাগুরা": ["মাগুরা সদর", "শালিখা", "মহম্মদপুর", "শ্রীপুর"]
        # ... এখানে অন্যান্য সব বিভাগ, জেলা এবং তাদের থানা যোগ করুন ...
    },
    "বরিশাল": {
        "বরিশাল": ["বরিশাল সদর", "বাকেরগঞ্জ", "বানারীপাড়া", "গৌরনদী", "আগৈলঝাড়া", "হিজলা", "মুলাদী", "মেহেন্দিগঞ্জ"],
        "বরিশাল সিটি করপোরেশন (BCC)": ["কোতোয়ালি", "বান্দ রোড", "নাথুলাবাদ", "রূপাতলী"],
        "ভোলা": ["ভোলা সদর", "বোরহানউদ্দিন", "চরফ্যাশন", "মনপুরা", "তজুমদ্দিন", "লালমোহন", "দৌলতখান"],
        "পটুয়াখালী": ["পটুয়াখালী সদর", "দুমকি", "মির্জাগঞ্জ", "গলাচিপা", "কলাপাড়া", "বাউফল", "দশমিনা", "রাঙ্গাবালী"],
        "পিরোজপুর": ["পিরোজপুর সদর", "নেছারাবাদ", "নাজিরপুর", "মঠবাড়িয়া", "কাউখালী", "ভান্ডারিয়া", "ইন্দুরকানী"],
        "ঝালকাঠি": ["ঝালকাঠি সদর", "নলছিটি", "রাজাপুর", "কাঠালিয়া"],
        "বরগুনা": ["বরগুনা সদর", "আমতলী", "পাথরঘাটা", "তালতলি", "বেতাগী", "বামনা"]
        # ... এখানে অন্যান্য সব বিভাগ, জেলা এবং তাদের থানা যোগ করুন ...
    },
    "রাজশাহী": {
        "রাজশাহী": ["রাজশাহী সদর", "গোদাগাড়ী", "তানোর", "পবা", "বাঘা", "বাঘমারা", "চারঘাট", "দুর্গাপুর", "পুঠিয়া",
                    "মোহনপুর"],
        "রাজশাহী সিটি করপোরেশন (RCC)": ["বোয়ালিয়া", "রাজপাড়া", "শাহ মখদুম", "মতিহার"],
        "বগুড়া": ["বগুড়া সদর", "শিবগঞ্জ", "ধুনট", "গাবতলী", "সারিয়াকান্দি", "নন্দিগ্রাম", "শাজাহানপুর", "কাহালু",
                   "সোনাতলা", "দুপচাঁচিয়া", "আদমদিঘী"],
        "পাবনা": ["পাবনা সদর", "সুজানগর", "চাটমোহর", "ফরিদপুর", "বেড়া", "ঈশ্বরদী", "আটঘরিয়া", "ভাঙ্গুড়া"],
        "নাটোর": ["নাটোর সদর", "গুরুদাসপুর", "সিংড়া", "বড়াইগ্রাম", "লালপুর", "বাগাতিপাড়া"],
        "নওগাঁ": ["নওগাঁ সদর", "পত্নীতলা", "ধামইরহাট", "রাণীনগর", "বদলগাছী", "আত্রাই", "মান্দা", "মহাদেবপুর", "সাপাহার",
                  "পোরশা", "নিয়ামতপুর"],
        "চাঁপাইনবাবগঞ্জ": ["চাঁপাইনবাবগঞ্জ সদর", "গোমস্তাপুর", "শিবগঞ্জ", "নাচোল", "ভোলাহাট"],
        "জয়পুরহাট": ["জয়পুরহাট সদর", "আক্কেলপুর", "কালাই", "ক্ষেতলাল", "পাঁচবিবি"],
        "সিরাজগঞ্জ": ["সিরাজগঞ্জ সদর", "বেলকুচি", "উল্লাপাড়া", "চৌহালী", "কাজিপুর", "রায়গঞ্জ", "কামারখন্দ", "তাড়াশ",
                      "শাহজাদপুর"]

        # ... এখানে অন্যান্য সব বিভাগ, জেলা এবং তাদের থানা যোগ করুন ...
    },
    "রংপুর": {
        "রংপুর": ["রংপুর সদর", "গঙ্গাচড়া", "পীরগাছা", "তারাগঞ্জ", "বদরগঞ্জ", "পীরগঞ্জ", "কাউনিয়া", "মিঠাপুকুর"],
        "রংপুর সিটি করপোরেশন (RpCC)": ["কোতোয়ালি", "হারাগাছ", "তাজহাট"],
        "দিনাজপুর": ["দিনাজপুর সদর", "বিরল", "বিরামপুর", "বিরামপুর", "বোচাগঞ্জ", "নবাবগঞ্জ", "পার্বতীপুর", "ঘোড়াঘাট",
                     "হাকিমপুর", "বিরামপুর", "ফুলবাড়ী", "বিরামপুর"],
        "নীলফামারী": ["নীলফামারী সদর", "ডোমার", "ডিমলা", "জলঢাকা", "কিশোরগঞ্জ", "সৈয়দপুর"],
        "পঞ্চগড়": ["পঞ্চগড় সদর", "তেতুলিয়া", "দেবীগঞ্জ", "আটোয়ারী", "বোদা"],
        "ঠাকুরগাঁও": ["ঠাকুরগাঁও সদর", "রাণীশংকৈল", "হরিপুর", "বালিয়াডাঙ্গী", "পীরগঞ্জ"],
        "গাইবান্ধা": ["গাইবান্ধা সদর", "সাদুল্যাপুর", "পলাশবাড়ী", "সাঘাটা", "গোবিন্দগঞ্জ", "সুন্দরগঞ্জ", "ফুলছড়ি"],
        "কুড়িগ্রাম": ["কুড়িগ্রাম সদর", "ভুরুঙ্গামারী", "রাজারহাট", "চিলমারী", "উলিপুর", "ফুলবাড়ী", "নাগেশ্বরী",
                       "রৌমারী", "চর রাজিবপুর"],
        "লালমনিরহাট": ["লালমনিরহাট সদর", "আদিতমারী", "কালীগঞ্জ", "পাটগ্রাম", "হাতীবান্ধা"]

    },
    "ময়মনসিংহ": {
        "ময়মনসিংহ": ["ময়মনসিংহ সদর", "ঈশ্বরগঞ্জ", "তারাকান্দা", "গৌরীপুর", "ফুলপুর", "নান্দাইল", "ফুলবাড়িয়া",
                      "ধোবাউড়া", "হালুয়াঘাট", "ত্রিশাল", "ভালুকা"],
        "ময়মনসিংহ সিটি করপোরেশন (MCC)": ["কোতোয়ালি", "ঈশ্বরগঞ্জ"],
        "শেরপুর": ["শেরপুর সদর", "নালিতাবাড়ী", "ঝিনাইগাতী", "শ্রীবরদী", "নকলা"],
        "জামালপুর": ["জামালপুর সদর", "মেলান্দহ", "ইসলামপুর", "মাদারগঞ্জ", "দেওয়ানগঞ্জ", "সরিষাবাড়ী", "বকশীগঞ্জ"],
        "নেত্রকোনা": ["নেত্রকোনা সদর", "দুর্গাপুর", "বারহাট্টা", "পূর্বধলা", "আটপাড়া", "কেন্দুয়া", "কলমাকান্দা",
                      "মদন", "খালিয়াজুরী"]

    },
    "সিলেট": {
        "সিলেট": ["সিলেট সদর", "বালাগঞ্জ", "বিশ্বনাথ", "বিয়ানীবাজার", "ফেঞ্চুগঞ্জ", "গোলাপগঞ্জ", "জৈন্তাপুর",
                  "কানাইঘাট", "কোম্পানীগঞ্জ", "জকিগঞ্জ", "ওসমানীনগর", "দক্ষিণ সুরমা"],
        "সিলেট সিটি করপোরেশন (SCC)": ["কোতোয়ালি", "শাহী ঈদগাহ", "আম্বরখানা", "দক্ষিণ সুরমা"],
        "হবিগঞ্জ": ["হবিগঞ্জ সদর", "নবীগঞ্জ", "বাহুবল", "চুনারুঘাট", "লাখাই", "আজমিরীগঞ্জ", "বানিয়াচং", "মাধবপুর"],
        "মৌলভীবাজার": ["মৌলভীবাজার সদর", "কুলাউড়া", "জুরি", "কমলগঞ্জ", "বড়লেখা", "রাজনগর", "শ্রীমঙ্গল"],
        "সুনামগঞ্জ": ["সুনামগঞ্জ সদর", "দিরাই", "জামালগঞ্জ", "তাহিরপুর", "দক্ষিণ সুনামগঞ্জ", "জগন্নাথপুর",
                      "বিশ্বম্ভরপুর", "ধর্মপাশা", "ছাতক", "দোয়ারাবাজার", "শাল্লা"]

    },
}


class SignUpForm(forms.Form):
    username = forms.CharField(label='ইউজার নাম', max_length=150, required=True, widget=forms.TextInput(attrs={
        'placeholder': 'ইউজার নাম লিখুন'
    })
                               )
    password = forms.CharField(label='পাসওয়ার্ড',  widget=forms.PasswordInput(attrs={
            'placeholder': 'আপনার পাসওয়ার্ড লিখুন'
        }), required=True)
    password2 = forms.CharField(label='পাসওয়ার্ড নিশ্চিত করুন', widget=forms.PasswordInput(attrs={
            'placeholder': 'পুনরায় আপনার পাসওয়ার্ড লিখুন'
        }), required=True)

    division_choices = [('', '----- বিভাগ নির্বাচন করুন -----')] + [(division, division) for division in
                                                                    BANGLADESH_DIVISIONS_DISTRICTS_THANAS.keys()]

    division = forms.ChoiceField(label='বিভাগ', choices=division_choices, required=True)
    district = forms.ChoiceField(label='জেলা', choices=[('', '----- জেলা নির্বাচন করুন -----')], required=True)
    thana = forms.ChoiceField(label='থানা', choices=[('', '----- থানা নির্বাচন করুন -----')], required=True)

    def clean_password2(self):
        cd = self.cleaned_data
        if cd.get('password') and cd.get('password2') and cd['password'] != cd['password2']:
            raise forms.ValidationError('পাসওয়ার্ড দুটি মেলেনি।')
        return cd.get('password2')

    def clean_username(self):
        username = self.cleaned_data.get('username')
        if User.objects.filter(username=username).exists():
            raise forms.ValidationError("এই ইউজারনেমটি bereits ব্যবহৃত হয়েছে।")
        return username


class QuestionPaperForm(forms.Form):
    program_name = forms.CharField(
        label="প্রোগ্রাম বা পরীক্ষার নাম",
        max_length=200,
        required=True,
        widget=forms.TextInput(attrs={'class': 'form-control'})
    )

    class_level = forms.ModelChoiceField(
        label="ক্লাস",
        queryset=ClassName.objects.none(),  # প্রাথমিকভাবে খালি রাখা হলো
        empty_label="সিলেক্ট ক্লাস",
        required=True,
        widget=forms.Select(attrs={'class': 'form-select'})
    )

    subjects = forms.ModelMultipleChoiceField(
        queryset=Subject.objects.none(),  # ভিউ থেকে লোড হবে
        widget=forms.CheckboxSelectMultiple,
        required=False
    )
    chapters = forms.ModelMultipleChoiceField(
        queryset=Chapter.objects.none(),  # ভিউ থেকে লোড হবে
        widget=forms.CheckboxSelectMultiple,
        required=False
    )

    QUESTION_TYPES = [
        ('', 'সিলেক্ট টাইপ'),
        ('mcq', 'বহু নির্বাচনি'),
        ('creative', 'সৃজনশীল'),
        ('combined', 'সমন্বিত প্রশ্ন'),
    ]
    question_type = forms.ChoiceField(
        label="প্রশ্ন টাইপ",
        choices=QUESTION_TYPES,
        required=True,
        widget=forms.Select(attrs={'class': 'form-select'})
    )

    number_of_questions = forms.IntegerField(
        label="সংখ্যা",
        required=True,
        widget=forms.NumberInput(attrs={'class': 'form-control'})
    )

    # এই মেথডটি নিশ্চিত করে যে প্রতিবার ফর্ম লোড হওয়ার সময় নতুন ডেটা আসবে
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.fields['class_level'].queryset = ClassName.objects.all()