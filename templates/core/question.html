{% extends 'users/base.html' %} {# -- প্রথম লাইনে base.html কে extend করতে হবে -- #}
{% block title %} ই-প্রশ্ন ব্যাংক| প্রশ্ন তৈরি{% endblock %} {# -- এই পেইজের জন্য একটি আলাদা টাইটেল -- #}

{% block content %} {# -- আপনার পেইজের সব মূল কন্টেন্ট এই ব্লকের ভেতরে থাকবে -- #}

    <div class="card">
        <div class="card-header">
            <h4 class="card-title mb-0">আমাদের সম্পর্কে</h4>
        </div>
        <div class="card-body">
            <p>
                ই-প্রশ্ন ব্যাংক-এ আপনাকে স্বাগতম! আমরা একটি অনলাইন প্ল্যাটফর্ম যা ছাত্রছাত্রীদের জন্য একটি সমৃদ্ধ প্রশ্ন
                ভান্ডার তৈরি করার লক্ষ্যে কাজ করছি।
                এখানে আপনি বিভিন্ন বিষয় এবং পরীক্ষার জন্য হাজার হাজার প্রশ্ন পাবেন যা আপনার প্রস্তুতিকে আরও শক্তিশালী
                করবে।
            </p>
            <p>
                আমাদের লক্ষ্য হলো শিক্ষার মান উন্নয়ন করা এবং সকলের জন্য জ্ঞানার্জন সহজলভ্য করা।
            </p>
    <form method="POST" action="{% url 'create_question_paper' %}">
    {% csrf_token %}

    <div class="mb-2 border-t border-x border-gray-400 py-2 border-dashed p-1">
        <h5><p class="text-center">নিচের ইনপুট ফিল্ড গুলো সিলেক্ট করে সাবমিট করুন</p></h5>
    </div>

    <div class="form-box">
        <div class="mb-6" style="width: 500px;">
            <label class="form-label" for="id_program_name">প্রোগ্রাম বা পরীক্ষার নাম লিখুন</label>
            <input type="text" class="form-control" name="program_name" id="id_program_name" placeholder="প্রোগ্রাম বা পরীক্ষার নাম লিখুন"/>
        </div>

        <div class="mb-3" style="width: 150px;">
    <label class="form-label" for="{{ form.class_level.id_for_label }}">{{ form.class_level.label }}</label>
            <select name="class_level" class="form-select" id="id_class_level" required>
                <option value="">সিলেক্ট ক্লাস</option>
                {% for c in classes %}
                    <option value="{{ c.id }}">{{ c.name }}</option>
                {% endfor %}
            </select>
        </div>

        <input type="hidden" name="subjects" id="hidden-subjects">
        <input type="hidden" name="chapters" id="hidden-chapters">

        <div class="row mb-3" style="width: 750px;">
            <div class="mt-6" style="width: 500px;">
                <button type="button" class="btn btn-outline-info" id="subject-modal-btn" data-bs-toggle="modal" data-bs-target="#subjectModal" disabled>
                    বিষয় নির্বাচন করুন
                </button>
            </div>
            <div class="container mt-4">
                <p id="selectedSubjects" class="fw-bold text-info"></p>
            </div>

            <div class="mt-6" style="width: 500px;">
                <button type="button" class="btn btn-outline-info" id="chapter-modal-btn" data-bs-toggle="modal" data-bs-target="#chapterModal" disabled>
                    অধ্যায় নির্বাচন করুন
                </button>
            </div>
            <div class="container mt-4">
                <p id="selectedChapters" class="fw-bold text-info"></p>
            </div>

            </div>

        <div class="card-body">
            <div class="demo-inline-spacing">
                <button type="submit" class="btn btn-label-info">সাবমিট করুন</button>
            </div>
        </div>
    </div>
</form>

<div class="modal fade" id="subjectModal" tabindex="-1" aria-labelledby="subjectModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title">বিষয় তালিকা</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
            <div class="modal-body">
                <form id="subjectForm"></form>
            </div>
            <div class="modal-footer">
                <div class="me-auto">
                    <button type="button" class="btn btn-sm btn-info" id="selectAllSubjectsBtn">সব সিলেক্ট করুন</button>
                    <button type="button" class="btn btn-sm btn-warning" id="unselectAllSubjectsBtn">সব আনসিলেক্ট করুন</button>
                </div>
                <button type="button" class="btn btn-info" id="saveSubjectsBtn" data-bs-dismiss="modal">সেভ করুন</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">বন্ধ করুন</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="chapterModal" tabindex="-1" aria-labelledby="chapterModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title">অধ্যায় তালিকা</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
            <div class="modal-body">
                <form id="chapterForm"></form>
            </div>
            <div class="modal-footer">
                <div class="me-auto">
                    <button type="button" class="btn btn-sm btn-secondary" id="selectAllChaptersBtn">সর্বমোট সিলেক্ট</button>
                    <button type="button" class="btn btn-sm btn-secondary" id="unselectAllChaptersBtn">আনসিলেক্ট</button>
                </div>
                <button type="button" class="btn btn-info" id="saveChaptersBtn" data-bs-dismiss="modal">সেভ করুন</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">বন্ধ করুন</button>
            </div>
        </div>
    </div>
</div>



        </div>

    </div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ✅ নিশ্চিত করুন HTML-এর id এবং এখানের id হুবহু এক
    const classSelect = document.getElementById('id_class_level');
    const subjectModalBtn = document.getElementById('subject-modal-btn');
    const chapterModalBtn = document.getElementById('chapter-modal-btn');
    const subjectForm = document.getElementById('subjectForm');
    const chapterForm = document.getElementById('chapterForm');
    const saveSubjectsBtn = document.getElementById('saveSubjectsBtn');
    const saveChaptersBtn = document.getElementById('saveChaptersBtn');
    const hiddenSubjects = document.getElementById('hidden-subjects');
    const hiddenChapters = document.getElementById('hidden-chapters');
    const selectedSubjectsP = document.getElementById('selectedSubjects');
    const selectedChaptersP = document.getElementById('selectedChapters');

    // ভ্যারিয়েবলটি null কিনা তা চেক করা হচ্ছে
    if (classSelect) {
        classSelect.addEventListener('change', function() {
            // ... (বাকি কোড আগের মতোই)
            const classId = this.value;
            subjectForm.innerHTML = '';
            chapterForm.innerHTML = '';
            chapterModalBtn.disabled = true;
            selectedSubjectsP.textContent = '';
            selectedChaptersP.textContent = '';
            hiddenSubjects.value = '';
            hiddenChapters.value = '';

            if (!classId) {
                subjectModalBtn.disabled = true;
                return;
            }
            subjectModalBtn.disabled = false;
            fetch(`{% url 'ajax_load_subjects' %}?class_id=${classId}`)
                .then(response => response.json())
                .then(subjects => {
                    subjects.forEach(subject => {
                        subjectForm.innerHTML += `
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="${subject.id}" id="subject-${subject.id}" name="subjects">
                                <label class="form-check-label" for="subject-${subject.id}">${subject.name}</label>
                            </div>`;
                    });
                });
        });
    }

    if (saveSubjectsBtn) {
        saveSubjectsBtn.addEventListener('click', function() {
            // ... (বাকি কোড আগের মতোই)
            const selectedCheckboxes = subjectForm.querySelectorAll('input:checked');
            const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.value);
            const selectedNames = Array.from(selectedCheckboxes).map(cb => cb.nextElementSibling.textContent);

            hiddenSubjects.value = selectedIds.join(',');
            selectedSubjectsP.textContent = 'নির্বাচিত বিষয়: ' + selectedNames.join(', ');

            chapterForm.innerHTML = '';
            chapterModalBtn.disabled = true;
            selectedChaptersP.textContent = '';
            hiddenChapters.value = '';

            if (selectedIds.length === 0) return;

            chapterModalBtn.disabled = false;
            fetch(`{% url 'ajax_load_chapters' %}?subject_ids=${selectedIds.join(',')}`)
                .then(response => response.json())
                .then(chapters => {
                    chapters.forEach(chapter => {
                        chapterForm.innerHTML += `
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="${chapter.id}" id="chapter-${chapter.id}" name="chapters">
                                <label class="form-check-label" for="chapter-${chapter.id}">${chapter.name}</label>
                            </div>`;
                    });
                });
        });
    }

    if (saveChaptersBtn) {
        saveChaptersBtn.addEventListener('click', function() {
            // ... (বাকি কোড আগের মতোই)
            const selectedCheckboxes = chapterForm.querySelectorAll('input:checked');
            const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.value);
            const selectedNames = Array.from(selectedCheckboxes).map(cb => cb.nextElementSibling.textContent);

            hiddenChapters.value = selectedIds.join(',');
            selectedChaptersP.textContent = 'নির্বাচিত অধ্যায়: ' + selectedNames.join(', ');
        });
    }

    // Helper functions to select/unselect all checkboxes inside a form element
    function selectAllIn(form) {
        if (!form) return;
        const boxes = form.querySelectorAll('input[type="checkbox"]');
        boxes.forEach(b => b.checked = true);
    }

    function unselectAllIn(form) {
        if (!form) return;
        const boxes = form.querySelectorAll('input[type="checkbox"]');
        boxes.forEach(b => b.checked = false);
    }

    // Wire up select/unselect buttons for subjects
    const selectAllSubjectsBtn = document.getElementById('selectAllSubjectsBtn');
    const unselectAllSubjectsBtn = document.getElementById('unselectAllSubjectsBtn');
    if (selectAllSubjectsBtn) selectAllSubjectsBtn.addEventListener('click', () => selectAllIn(subjectForm));
    if (unselectAllSubjectsBtn) unselectAllSubjectsBtn.addEventListener('click', () => unselectAllIn(subjectForm));

    // Wire up select/unselect buttons for chapters
    const selectAllChaptersBtn = document.getElementById('selectAllChaptersBtn');
    const unselectAllChaptersBtn = document.getElementById('unselectAllChaptersBtn');
    if (selectAllChaptersBtn) selectAllChaptersBtn.addEventListener('click', () => selectAllIn(chapterForm));
    if (unselectAllChaptersBtn) unselectAllChaptersBtn.addEventListener('click', () => unselectAllIn(chapterForm));
});
</script>

{% endblock %}